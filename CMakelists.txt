cmake_minimum_required(VERSION 3.27)

project(Mandlebrot
		VERSION 		1.0
		DESCRIPTION 	"Generates a mandlebrot"
		LANGUAGES		C CXX)

set(CMAKE_C_COMPILER 		"gcc")
set(CMAKE_CXX_COMPILER 		"g++")

set(CMAKE_SYSTEM_NAME 		Generic)
set(CMAKE_SYSTEM_VERSION 	1)

find_package(glfw3 3.3 REQUIRED)

# Add library here before compile options are introduced to prevent 381 or so warnings
add_library(glad STATIC lib/glad/glad.c)

add_compile_options(
	-Wall
	-Wextra
	-Wpedantic
	-fPIC
	-static
	-static-libgcc
	-static-libstdc++
	# C compile options
	$<$<COMPILE_LANG_AND_ID:C,GNU>:-std=c11>
	
	# C++ compile options
	$<$<COMPILE_LANG_AND_ID:CXX,GNU>:-std=c++20>
	
	# Debug options
	$<$<CONFIG:DEBUG>:-g3>
  	$<$<CONFIG:DEBUG>:-Og>

	# Release options
  	$<$<CONFIG:RELEASE>:-O3>
)

add_link_options(

)

add_compile_definitions(
	# Debug definitions
	$<$<CONFIG:DEBUG>:DEBUG>
	# Release definitions
	$<$<CONFIG:RELEASE>:NDEBUG>
	# C defintions
	# $<$<COMPILE_LANG_AND_ID:C,GNU>:__LANGUAGE=C>
	# C++ definitions
	# $<$<COMPILE_LANG_AND_ID:CXX,GNU>:__LANGUAGE=CXX>
)

set(SHADER_SRC
	res/shaders/fragment_shader.frag
	res/shaders/vertex_shader.vert)

message("Shaders found:")

foreach(SHADER IN ITEMS ${SHADER_SRC})
	message(${SHADER})
endforeach()

add_custom_command(
	OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/generated/gen_shaders.cpp
	COMMAND bash -c "res/gen_shaders.sh"
	WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
	DEPENDS ${SHADER_SRC} res/gen_shaders.sh
	BYPRODUCTS ${CMAKE_CURRENT_SOURCE_DIR}/generated/gen_shaders.h
)

include_directories(inc/)
include_directories(lib/)
include_directories(generated)

add_executable(${PROJECT_NAME} 	main.cpp
								src/util.cpp
								generated/gen_shaders.cpp)

target_link_libraries(${PROJECT_NAME} opengl32)
target_link_libraries(${PROJECT_NAME} glfw)
target_link_libraries(${PROJECT_NAME} glad)